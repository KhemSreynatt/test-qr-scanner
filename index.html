<!DOCTYPE html>
<html>

<head>
    <title>QR Scanner Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
    <div id="result">Tap the button below to scan a QR code</div>
    <script>
        let tg = window.Telegram.WebApp;

        function openQRScanner() {
            tg.showScanQrPopup({
                text: "Please scan a QR code"
            }, function (qrCode) {
                console.log("Scanned QR Code:", qrCode); // Debug log
                if (qrCode) {
                    document.getElementById('result').textContent = "Scanned: " + qrCode;
                    console.log("Processing QR code locally:", qrCode);
                    // Further processing...
                } else {
                    console.log("QR scanning failed or was cancelled"); // Debug log
                    document.getElementById('result').textContent = "Scanning cancelled or failed";
                }
            });
        }

        // Set up the main button
        tg.MainButton.text = "Scan QR Code";
        tg.MainButton.onClick(openQRScanner);
        tg.MainButton.show();

        // Ensure the button is visible when the app is expanded
        tg.onEvent('viewportChanged', function () {
            if (tg.isExpanded) {
                tg.MainButton.show();
            }
        });
    </script>
</body>

</html>